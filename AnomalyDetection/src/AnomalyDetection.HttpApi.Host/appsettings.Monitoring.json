{
  "ApplicationInsights": {
    "ConnectionString": "${APPINSIGHTS_CONNECTION_STRING}",
    "InstrumentationKey": "${APPINSIGHTS_INSTRUMENTATIONKEY}",
    "EnableAdaptiveSampling": true,
    "EnableQuickPulseMetricStream": true,
    "EnableAuthenticationTrackingJavaScript": true,
    "EnableDependencyTrackingTelemetryModule": true,
    "EnablePerformanceCounterCollectionModule": true,
    "EnableRequestTrackingTelemetryModule": true,
    "EnableEventCounterCollectionModule": true,
    "SamplingSettings": {
      "MaxTelemetryItemsPerSecond": 20,
      "EvaluationInterval": "00:00:15",
      "SamplingPercentageDecreaseTimeout": "00:02:00",
      "SamplingPercentageIncreaseTimeout": "00:15:00",
      "MinSamplingPercentage": 0.1,
      "MaxSamplingPercentage": 100.0,
      "MovingAverageRatio": 0.25
    }
  },
  "Logging": {
    "LogLevel": {
      "Default": "Information",
      "Microsoft": "Warning",
      "Microsoft.Hosting.Lifetime": "Information",
      "Microsoft.EntityFrameworkCore": "Warning",
      "AnomalyDetection": "Information"
    },
    "ApplicationInsights": {
      "LogLevel": {
        "Default": "Information",
        "Microsoft": "Warning"
      }
    }
  },
  "HealthChecks": {
    "UI": {
      "EvaluationTimeInSeconds": 10,
      "MinimumSecondsBetweenFailureNotifications": 60,
      "HealthCheckDatabaseConnectionString": "${HEALTHCHECK_DB_CONNECTION}",
      "Webhooks": [
        {
          "Name": "Slack",
          "Uri": "${SLACK_WEBHOOK_URL}",
          "Payload": "{ \"text\": \"Health check failed: [[LIVENESS]] with status [[STATUS]] ([[DESCRIPTIONS]])\", \"channel\": \"#alerts\" }",
          "RestoredPayload": "{ \"text\": \"Health check restored: [[LIVENESS]] is now [[STATUS]]\", \"channel\": \"#alerts\" }"
        }
      ]
    }
  },
  "Metrics": {
    "Prometheus": {
      "Enabled": true,
      "Port": 9090,
      "Path": "/metrics"
    },
    "CustomMetrics": {
      "AnomalyDetection": {
        "DetectionExecutions": {
          "Name": "anomaly_detection_executions_total",
          "Description": "Total number of anomaly detection executions",
          "Type": "Counter"
        },
        "DetectionLatency": {
          "Name": "anomaly_detection_latency_seconds",
          "Description": "Anomaly detection execution latency in seconds",
          "Type": "Histogram"
        },
        "ActiveSessions": {
          "Name": "active_user_sessions",
          "Description": "Number of active user sessions",
          "Type": "Gauge"
        },
        "DatabaseConnections": {
          "Name": "database_connections_active",
          "Description": "Number of active database connections",
          "Type": "Gauge"
        },
        "CacheHitRate": {
          "Name": "cache_hit_rate",
          "Description": "Cache hit rate percentage",
          "Type": "Gauge"
        }
      }
    }
  },
  "Alerting": {
    "Rules": [
      {
        "Name": "HighErrorRate",
        "Description": "Alert when error rate exceeds 5%",
        "Condition": "error_rate > 0.05",
        "Severity": "Critical",
        "NotificationChannels": ["slack", "email"]
      },
      {
        "Name": "HighResponseTime",
        "Description": "Alert when average response time exceeds 2 seconds",
        "Condition": "avg_response_time > 2000",
        "Severity": "Warning",
        "NotificationChannels": ["slack"]
      },
      {
        "Name": "DatabaseConnectionFailure",
        "Description": "Alert when database connection fails",
        "Condition": "database_connection_failed == true",
        "Severity": "Critical",
        "NotificationChannels": ["slack", "email", "sms"]
      },
      {
        "Name": "HighMemoryUsage",
        "Description": "Alert when memory usage exceeds 80%",
        "Condition": "memory_usage_percent > 80",
        "Severity": "Warning",
        "NotificationChannels": ["slack"]
      },
      {
        "Name": "LowCacheHitRate",
        "Description": "Alert when cache hit rate drops below 70%",
        "Condition": "cache_hit_rate < 0.70",
        "Severity": "Warning",
        "NotificationChannels": ["slack"]
      }
    ]
  },
  "Tracing": {
    "OpenTelemetry": {
      "Enabled": true,
      "ServiceName": "AnomalyDetection.HttpApi.Host",
      "ServiceVersion": "1.0.0",
      "Exporters": {
        "Jaeger": {
          "Enabled": true,
          "Endpoint": "${JAEGER_ENDPOINT}",
          "Protocol": "grpc"
        },
        "ApplicationInsights": {
          "Enabled": true
        }
      },
      "Instrumentation": {
        "AspNetCore": true,
        "HttpClient": true,
        "EntityFrameworkCore": true,
        "Redis": true,
        "SqlClient": true
      }
    }
  }
}